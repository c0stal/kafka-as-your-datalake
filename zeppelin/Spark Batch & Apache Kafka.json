{"paragraphs":[{"text":"%pyspark\nrawDf = spark.read.format(\"kafka\").option(\"kafka.bootstrap.servers\", \"kafka-1:19092,kafka-2:19093\").option(\"subscribe\", \"truck_position\").load()","user":"admin","dateUpdated":"2020-07-20T13:36:47+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116514_642418143","id":"20200718-160637_519019038","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:36:47+0000","dateFinished":"2020-07-20T13:36:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20342","focus":true,"title":"Subscribe to Kafka Topic \"truck_position\" and load it as a data frame","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nrawDf.printSchema","user":"admin","dateUpdated":"2020-07-20T13:36:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595250483324_-778501320","id":"20200720-130803_456751331","dateCreated":"2020-07-20T13:08:03+0000","dateStarted":"2020-07-20T13:36:50+0000","dateFinished":"2020-07-20T13:36:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20343","focus":true,"title":"Print Schema of data frame","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<bound method DataFrame.printSchema of DataFrame[key: binary, value: binary, topic: string, partition: int, offset: bigint, timestamp: timestamp, timestampType: int]>\n"}]}},{"text":"%pyspark\nfrom pyspark.sql.types import *\n\ntruckPositionSchema = StructType().add(\"timestamp\", TimestampType()).add(\"truckId\",LongType()).add(\"driverId\", LongType()).add(\"routeId\", LongType()).add(\"eventType\", StringType()).add(\"latitude\", DoubleType()).add(\"longitude\", DoubleType()).add(\"correlationId\", StringType()) \n","user":"admin","dateUpdated":"2020-07-20T13:36:52+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1595186116511_-1318959128","id":"20200718-155818_41606634","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:36:53+0000","dateFinished":"2020-07-20T13:36:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:20341","title":"Define a custom schema reflecting the truck_position JSON data"},{"text":"%pyspark\nfrom pyspark.sql.functions import from_json\n\njsonDf = rawDf.selectExpr(\"CAST(value AS string)\")\njsonDf = jsonDf.select(from_json(jsonDf.value, truckPositionSchema).alias(\"json\")).selectExpr(\"json.*\", \"cast(cast (json.timestamp as double) / 1000 as timestamp) as eventTime\")","user":"admin","dateUpdated":"2020-07-20T13:36:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116516_1065893003","id":"20200718-160736_1625192483","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:36:55+0000","dateFinished":"2020-07-20T13:36:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20344","title":"Convert JSON message into new data frame using schema defined before ","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\njsonDf.printSchema","user":"admin","dateUpdated":"2020-07-20T13:36:57+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116522_-118947902","id":"20200718-160743_2110644979","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:36:58+0000","dateFinished":"2020-07-20T13:36:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20345","title":"Print schema of new data frame","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<bound method DataFrame.printSchema of DataFrame[timestamp: timestamp, truckId: bigint, driverId: bigint, routeId: bigint, eventType: string, latitude: double, longitude: double, correlationId: string, eventTime: timestamp]>\n"}]}},{"text":"%pyspark\njsonDf.show(10)","user":"admin","dateUpdated":"2020-07-20T13:37:01+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116524_-560519942","id":"20200718-155952_1856595182","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:37:01+0000","dateFinished":"2020-07-20T13:37:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20346","title":"Show the first 10 rows of the data frame","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-------+--------+----------+---------+--------+---------+-------------------+--------------------+\n|           timestamp|truckId|driverId|   routeId|eventType|latitude|longitude|      correlationId|           eventTime|\n+--------------------+-------+--------+----------+---------+--------+---------+-------------------+--------------------+\n|52513-03-14 20:16...|     59|      23|1962261785|   Normal|    40.7|   -89.52|2661060476221946970|2020-07-17 12:35:...|\n|52513-03-14 21:15...|     59|      23|1962261785|   Normal|   40.86|   -89.91|2661060476221946970|2020-07-17 12:35:...|\n|52513-03-14 22:09...|     59|      23|1962261785|   Normal|   40.96|   -90.29|2661060476221946970|2020-07-17 12:35:...|\n|52513-03-14 23:04...|     59|      23|1962261785|   Normal|   41.54|   -90.44|2661060476221946970|2020-07-17 12:35:...|\n|52513-03-15 00:10...|     59|      23|1962261785|   Normal|   41.62|    -90.7|2661060476221946970|2020-07-17 12:36:...|\n|52513-03-15 01:11...|     59|      23|1962261785|   Normal|   41.72|   -91.05|2661060476221946970|2020-07-17 12:36:...|\n|52513-03-15 02:13...|     59|      23|1962261785|   Normal|   41.71|   -91.32|2661060476221946970|2020-07-17 12:36:...|\n|52513-03-15 03:10...|     59|      23|1962261785|   Normal|   41.74|   -91.47|2661060476221946970|2020-07-17 12:36:...|\n|52513-03-15 04:08...|     59|      23|1962261785|   Normal|   41.72|   -91.63|2661060476221946970|2020-07-17 12:36:...|\n|52513-03-15 05:03...|     59|      23|1962261785|   Normal|   42.23|   -91.78|2661060476221946970|2020-07-17 12:36:...|\n+--------------------+-------+--------+----------+---------+--------+---------+-------------------+--------------------+\nonly showing top 10 rows\n\n"}]}},{"text":"%pyspark\njsonDf.createOrReplaceTempView(\"truck_position\")","user":"admin","dateUpdated":"2020-07-20T13:34:40+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116525_-181659843","id":"20200718-161103_1148050857","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:11:58+0000","dateFinished":"2020-07-20T13:11:58+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20347","title":"Register data frame as temporary table so it can be used with Spark SQL"},{"text":"%sql\nSELECT count(*) from truck_position","user":"admin","dateUpdated":"2020-07-20T13:35:44+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"count(1)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116527_-1379025479","id":"20200718-161123_1697031727","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:12:02+0000","dateFinished":"2020-07-20T13:12:13+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20348","title":"Use the SQL directive to work on the temporary table and show the number of rows in the table (i.e. number of messages in the Kafka topic)"},{"text":"%sql\nselect * from truck_position","user":"admin","dateUpdated":"2020-07-20T13:36:30+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"timestamp":"string","truckId":"string","driverId":"string","routeId":"string","eventType":"string","latitude":"string","longitude":"string","correlationId":"string","eventTime":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595186116527_1900830769","id":"20200718-161135_762005566","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:12:18+0000","dateFinished":"2020-07-20T13:12:20+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20349","title":"Show table with no restriction"},{"text":"%sql\nselect * from truck_position where eventType != 'Normal'","user":"admin","dateUpdated":"2020-07-20T13:36:08+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"timestamp":"string","truckId":"string","driverId":"string","routeId":"string","eventType":"string","latitude":"string","longitude":"string","correlationId":"string","eventTime":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"title":true,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595252168769_-1085266609","id":"20200720-133608_1707622190","dateCreated":"2020-07-20T13:36:08+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:21307","title":"Show all the rows where the event type is not normal"},{"text":"%sql\n","user":"admin","dateUpdated":"2020-07-20T13:36:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1595252195518_1332028352","id":"20200720-133635_983461582","dateCreated":"2020-07-20T13:36:35+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:21394"},{"text":"%pyspark\nrawDf = spark.read.format(\"kafka\").option(\"kafka.bootstrap.servers\", \"kafka-1:19092,kafka-2:19093\").option(\"subscribe\", \"truck_position\").option(\"startingOffsetsByTimestamp\", \"{'truck_position': {'0': 1595239200}}\").load()\n","user":"admin","dateUpdated":"2020-07-20T13:20:13+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1595186116531_845534398","id":"20200718-161203_284394069","dateCreated":"2020-07-19T19:15:16+0000","dateStarted":"2020-07-20T13:20:13+0000","dateFinished":"2020-07-20T13:20:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20350"},{"text":"%pyspark\nfrom pyspark.sql.functions import from_json\n\njsonDf = rawDf.selectExpr(\"CAST(value AS string)\")\njsonDf = jsonDf.select(from_json(jsonDf.value, truckPositionSchema).alias(\"json\")).selectExpr(\"json.*\", \"cast(cast (json.timestamp as double) / 1000 as timestamp) as eventTime\")","user":"admin","dateUpdated":"2020-07-20T13:22:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1595251087054_-680009971","id":"20200720-131807_170975397","dateCreated":"2020-07-20T13:18:07+0000","dateStarted":"2020-07-20T13:22:20+0000","dateFinished":"2020-07-20T13:22:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20351"},{"text":"%pyspark\njsonDf.count()","user":"admin","dateUpdated":"2020-07-20T13:22:33+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"492186\n"}]},"apps":[],"jobName":"paragraph_1595251129001_1277296851","id":"20200720-131849_1102539196","dateCreated":"2020-07-20T13:18:49+0000","dateStarted":"2020-07-20T13:22:33+0000","dateFinished":"2020-07-20T13:22:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:20352"}],"name":"Spark Batch & Apache Kafka","id":"2FGG2N17Q","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}